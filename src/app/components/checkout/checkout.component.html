<section class="custom-accordion">
  <!-- Popup Message -->
  <div *ngIf="showPopup" class="popup-overlay">
    <div class="popup" [ngClass]="{'success': popupType === 'success', 'error': popupType === 'error'}">
      <div class="popup-content">
        <div class="popup-icon">
          <i *ngIf="popupType === 'success'" class="fas fa-check-circle"></i>
          <i *ngIf="popupType === 'error'" class="fas fa-exclamation-circle"></i>
        </div>
        <div class="popup-message">{{ popupMessage }}</div>
      </div>
    </div>
  </div>

  <!-- Billing Address -->
  <div class="accordion-box">
    <input type="checkbox" id="billing-toggle" class="accordion-toggle">
    <label for="billing-toggle" class="accordion-header">Billing Address</label>
    <div class="accordion-body">
      <form>
        <div class="form-grid">
          <div class="form-row two-columns">
            <input type="text" name="addr[billing][first_name]" placeholder="First Name" />
            <input type="text" name="addr[billing][last_name]" placeholder="Last Name" />
          </div>
          <div class="form-row">
            <input type="email" name="addr[billing][email]" placeholder="Email Address" />
          </div>
          <div class="form-row">
            <input type="text" name="addr[billing][phone_number]" placeholder="Phone Number" />
          </div>
          <div class="form-row">
            <input type="text" name="addr[billing][address]" placeholder="Mailing Address" />
          </div>
          <div class="form-row two-columns">
            <input type="text" name="addr[billing][city]" placeholder="City" />
            <input type="text" name="addr[billing][post_code]" placeholder="Post Code" />
          </div>
          <div class="form-row two-columns">
            <select name="addr[billing][country]">
              <option value="">Select Country</option>
            </select>
            <input type="text" name="addr[billing][state]" placeholder="State" />
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Shipping Address -->
  <div class="accordion-box">
    <input type="checkbox" id="shipping-toggle" class="accordion-toggle">
    <label for="shipping-toggle" class="accordion-header">Shipping Address</label>
    <div class="accordion-body">
      <form>
        <div class="form-grid">
          <div class="form-row two-columns">
            <input type="text" name="addr[shipping][first_name]" placeholder="First Name" />
            <input type="text" name="addr[shipping][last_name]" placeholder="Last Name" />
          </div>
          <div class="form-row">
            <input type="email" name="addr[shipping][email]" placeholder="Email Address" />
          </div>
          <div class="form-row">
            <input type="text" name="addr[shipping][phone_number]" placeholder="Phone Number" />
          </div>
          <div class="form-row">
            <input type="text" name="addr[shipping][address]" placeholder="Mailing Address" />
          </div>
          <div class="form-row two-columns">
            <input type="text" name="addr[shipping][city]" placeholder="City" />
            <input type="text" name="addr[shipping][post_code]" placeholder="Post Code" />
          </div>
          <div class="form-row two-columns">
            <select name="addr[shipping][country]">
              <option value="">Select Country</option>
            </select>
            <input type="text" name="addr[shipping][state]" placeholder="State" />
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Payment Method -->
  <div class="accordion-box">
    <input type="checkbox" id="payment-toggle" class="accordion-toggle">
    <label for="payment-toggle" class="accordion-header">Payment Method</label>
    <div class="accordion-body">
      <form>
        <div class="form-grid">
          <div class="form-row">
            <select name="payment_method" [(ngModel)]="checkoutData.payment_method" (change)="onPaymentMethodChange()">
              <option value="">Select Payment Method</option>
              <option value="stripe">Credit Card (Stripe)</option>
              <option value="cash">Cash on Delivery</option>
            </select>
          </div>
        </div>
      </form>

      <!-- Stripe Payment Form -->
      <div *ngIf="showStripeForm" class="stripe-payment-form">
        <div #paymentElement id="payment-element"></div>
      </div>
    </div>
  </div>

  <!-- Order Summary -->
  <div class="accordion-box">
    <input type="checkbox" id="summary-toggle" class="accordion-toggle" checked>
    <label for="summary-toggle" class="accordion-header">Order Summary</label>
    <div class="accordion-body">
      <div class="order-summary">
        <div *ngIf="cartItems.length === 0" class="empty-cart">
          Your cart is empty
        </div>
        <div class="summary-item" *ngFor="let item of cartItems">
          <div class="item-details">
            <span class="item-name">{{item.name || 'Product ' + item.productId}}</span>
            <span class="item-quantity">x{{item.quantity}}</span>
          </div>
          <span class="item-price">${{item.price * item.quantity}}</span>
        </div>
        <div class="summary-total">
          <span>Total:</span>
          <span>${{totalPrice}}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Checkout Button -->
  <div class="checkout-button-container">
    <button class="checkout-button" (click)="processCheckout()" [disabled]="isLoading || cartItems.length === 0">
      <span *ngIf="!isLoading">Complete Checkout</span>
      <span *ngIf="isLoading" class="loading-spinner"></span>
    </button>
  </div>
</section>
